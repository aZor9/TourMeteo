<!-- Nutrition Plan Card -->
<div *ngIf="slots.length > 0" class="mb-4 bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden">

  <!-- Header -->
  <div class="px-4 sm:px-6 py-4 border-b border-slate-100">
    <div class="flex items-center justify-between gap-3 flex-wrap">
      <div>
        <div class="text-xs font-semibold text-slate-400 uppercase tracking-wider mb-1">üçå Plan nutrition</div>
        <p class="text-sm text-slate-600">{{ summary }}</p>
      </div>
      <button (click)="showCustomTarget = !showCustomTarget"
              class="text-xs px-3 py-1.5 rounded-lg transition-colors"
              [ngClass]="showCustomTarget ? 'bg-amber-100 text-amber-700' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'">
        ‚öôÔ∏è Personnaliser
      </button>
    </div>

    <!-- Custom target -->
    <div *ngIf="showCustomTarget" class="mt-3 flex items-center gap-3 p-3 bg-amber-50 rounded-lg border border-amber-200">
      <label class="text-xs font-medium text-slate-600 whitespace-nowrap">Cible glucides/h :</label>
      <input type="number" [(ngModel)]="targetCarbsPerHour" (ngModelChange)="onTargetChange()"
             min="20" max="120" step="5"
             class="w-20 border border-slate-200 rounded-lg px-2 py-1.5 text-sm bg-white focus:ring-2 focus:ring-amber-400 focus:border-amber-400 outline-none" />
      <span class="text-xs text-slate-500">g/h</span>
      <span class="text-[11px] text-slate-400">(recommand√© : 40-90g/h selon l'intensit√©)</span>
    </div>
  </div>

  <!-- Timeline -->
  <div class="p-4 sm:p-5">
    <div class="relative">
      <!-- Vertical line -->
      <div class="absolute left-4 top-0 bottom-0 w-0.5 bg-slate-200"></div>

      <div *ngFor="let slot of slots; let i = index" class="relative pl-10 pb-4 last:pb-0">
        <!-- Dot -->
        <div class="absolute left-2.5 top-1 w-3 h-3 rounded-full border-2 border-white shadow-sm"
             [ngClass]="slot.carbsG > 0 ? 'bg-amber-400' : 'bg-blue-400'"></div>

        <div class="flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-4">
          <!-- Time + distance -->
          <div class="flex items-center gap-2 min-w-[120px]">
            <span class="text-xs font-semibold text-slate-700 bg-slate-100 rounded px-2 py-0.5">{{ slot.timeLabel }}</span>
            <span class="text-[11px] text-slate-400">~{{ slot.distanceKm }} km</span>
          </div>

          <!-- What to take -->
          <div class="flex items-center gap-2 flex-1">
            <span class="text-lg">{{ slot.typeEmoji }}</span>
            <span class="text-sm text-slate-700">{{ slot.typeLabel }}</span>
          </div>

          <!-- Amounts -->
          <div class="flex items-center gap-3 text-xs text-slate-500">
            <span *ngIf="slot.carbsG > 0" class="bg-amber-50 text-amber-700 px-2 py-0.5 rounded font-medium">{{ slot.carbsG }}g glucides</span>
            <span class="bg-blue-50 text-blue-700 px-2 py-0.5 rounded font-medium">{{ slot.hydrationMl }} ml</span>
          </div>
        </div>

        <div *ngIf="slot.note" class="mt-1 text-[11px] text-slate-400 italic">{{ slot.note }}</div>
      </div>
    </div>
  </div>

  <!-- Footer totals -->
  <div class="px-4 sm:px-6 py-3 bg-slate-50 border-t border-slate-100 flex flex-wrap gap-4 text-xs font-medium">
    <span class="text-amber-700">üç¨ Total : {{ totalCarbs }}g glucides</span>
    <span class="text-blue-700">üíß Total : {{ (totalHydration / 1000).toFixed(1) }}L</span>
    <span class="text-slate-500">‚è±Ô∏è Dur√©e : {{ durationHours.toFixed(1) }}h</span>
  </div>
</div>
