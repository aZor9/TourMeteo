<div class="px-3 sm:px-0 max-w-3xl mx-auto py-4">
<section class="bg-white rounded-xl border border-slate-200 p-4 sm:p-6 shadow-sm">

  <!-- Header -->
  <header class="mb-6">
    <h1 class="text-2xl font-bold text-slate-900">{{ title }}</h1>
    <p class="text-slate-500 mt-1">Meteo Ride ‚Äî application de comparaison m√©t√©o entre plusieurs villes, heure par heure, pens√©e pour les cyclistes et randonneurs.</p>
    <div class="flex items-center gap-3 mt-3 text-sm">
      <span (click)="onVersionTap()" class="inline-flex items-center gap-1 bg-indigo-50 text-indigo-700 px-2.5 py-0.5 rounded-full font-medium cursor-default select-none" title="Version">v2.2.0</span>
      <span class="text-slate-400">Angular 21 ¬∑ Tailwind CSS ¬∑ Leaflet</span>
      <span *ngIf="devTapCount >= 3 && devTapCount < 5" class="text-xs text-slate-300 animate-pulse">{{ 5 - devTapCount }} tap(s)...</span>
      <span *ngIf="showDevOptions" class="text-xs text-emerald-500 font-medium">üîì Mode dev activ√©</span>
    </div>
    <p class="text-slate-500 mt-2 text-sm">
      GitHub : <a href="https://github.com/aZor9/TourMeteo" class="text-primary hover:underline" target="_blank">D√©p√¥t GitHub</a>
      ¬∑ D√©mo : <a href="https://meteo-ride.vercel.app/" class="text-primary hover:underline" target="_blank">Voir la d√©mo</a>
    </p>
  </header>

  <!-- Expand / Collapse all -->
  <div class="flex gap-2 mb-4 text-xs">
    <button (click)="expandAll()" class="px-2.5 py-1 rounded bg-slate-100 hover:bg-slate-200 text-slate-600 transition-colors">Tout ouvrir</button>
    <button (click)="collapseAll()" class="px-2.5 py-1 rounded bg-slate-100 hover:bg-slate-200 text-slate-600 transition-colors">Tout fermer</button>
  </div>

  <!-- ‚îÄ‚îÄ‚îÄ Accordion sections ‚îÄ‚îÄ‚îÄ -->
  <div class="space-y-2">

    <!-- 0 ‚Äî Fonctionnalit√©s -->
    <ng-container *ngFor="let sec of sections; let idx = index">

      <!-- Group header (User / Dev) -->
      <div *ngIf="idx === 0 || sections[idx - 1].group !== sec.group" class="pt-3">
        <div class="flex items-center gap-2">
          <div class="h-px bg-slate-200 flex-1"></div>
          <h2 class="text-[11px] font-semibold text-slate-400 uppercase tracking-wider">
            {{ sec.group === 'user' ? 'Utilisateurs' : 'D√©veloppeurs' }}
          </h2>
          <div class="h-px bg-slate-200 flex-1"></div>
        </div>
        <p *ngIf="sec.group === 'user'" class="text-xs text-slate-500 mt-1">
          Infos principales et guide d'utilisation.
        </p>
        <p *ngIf="sec.group === 'dev'" class="text-xs text-slate-500 mt-1">
          D√©tails techniques (stack, APIs, architecture).
        </p>
      </div>

      <!-- ===== FEATURES ===== -->
      <div *ngIf="sec.id === 'features'" class="border border-slate-200 rounded-lg overflow-hidden">
        <button (click)="toggle(sec)" class="w-full flex items-center gap-2 px-4 py-3 bg-slate-50 hover:bg-slate-100 transition-colors text-left">
          <span class="text-lg">{{ sec.icon }}</span>
          <span class="font-semibold text-slate-800 flex-1">{{ sec.title }}</span>
          <svg [class.rotate-180]="sec.open" class="w-4 h-4 text-slate-400 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
        </button>
        <div *ngIf="sec.open" class="px-4 py-3 text-sm text-slate-700 space-y-1.5 border-t border-slate-100">
          <ul class="list-disc pl-5 space-y-1">
            <li><strong>Recherche multi-villes :</strong> comparer la m√©t√©o horaire de plusieurs villes sur une m√™me date</li>
            <li><strong>Filtres d'affichage :</strong> temp√©rature, vent, r√©sum√© m√©t√©o (activables/d√©sactivables)</li>
            <li><strong>Vue mobile optimis√©e :</strong> cartes avec emoji m√©t√©o en fond, indicateur jour/nuit sous l'heure, affichage des pr√©cipitations</li>
            <li><strong>Import GPX :</strong> charger un fichier <code>.gpx</code> pour calculer la distance totale et pr√©voir la m√©t√©o du parcours</li>
            <li><strong>Carte interactive :</strong> trac√© du parcours GPX avec marqueurs num√©rot√©s (Leaflet + OpenStreetMap)</li>
            <li><strong>M√©t√©o par passage :</strong> temp√©rature, ressenti, vent, humidit√©, probabilit√© de pluie, pr√©cipitations et emoji weathercode</li>
            <li><strong>Score de sortie v√©lo :</strong> score /100, recommandation de tenue cycliste, alertes et conseils personnalis√©s</li>
            <li><strong>Export PNG :</strong> image du tableau des passages avec score v√©lo et tenue recommand√©e (rendu Canvas natif)</li>
            <li><strong>Partage :</strong> via l'API Web Share ou t√©l√©chargement automatique</li>
            <li><strong>Filtres r√©sultats :</strong> basculer entre vue r√©sum√© et d√©tail complet, masquer/afficher carte, score ou tableau individuellement</li>
            <li><strong>Rafra√Æchir m√©t√©o :</strong> changer la date/heure sans re-g√©ocoder les villes (garde les noms de villes en cache)</li>
            <li><strong>Historique <span class="text-xs text-amber-500">(üîß dev)</span> :</strong> sauvegarde locale des trajets, rechargement rapide, gestion du stockage</li>
          </ul>
        </div>
      </div>

      <!-- ===== GPX & EXPORT ===== -->
      <div *ngIf="sec.id === 'gpx'" class="border border-slate-200 rounded-lg overflow-hidden">
        <button (click)="toggle(sec)" class="w-full flex items-center gap-2 px-4 py-3 bg-slate-50 hover:bg-slate-100 transition-colors text-left">
          <span class="text-lg">{{ sec.icon }}</span>
          <span class="font-semibold text-slate-800 flex-1">{{ sec.title }}</span>
          <svg [class.rotate-180]="sec.open" class="w-4 h-4 text-slate-400 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
        </button>
        <div *ngIf="sec.open" class="px-4 py-3 text-sm text-slate-700 space-y-2 border-t border-slate-100">
          <p>Importez un fichier <strong>.gpx</strong> via la page <em>GPX</em>. L'application parse les points <code>trkpt</code>, calcule la distance totale (formule de Haversine), puis estime l'heure de passage et la distance cumulative √† chaque point selon la vitesse moyenne renseign√©e.</p>
          <p>Pour chaque point, un reverse-g√©ocodage Nominatim identifie la ville, puis la m√©t√©o horaire est r√©cup√©r√©e via Open-Meteo. Les doublons cons√©cutifs sont filtr√©s automatiquement.</p>
          <p>Le trac√© complet est affich√© sur une <strong>carte interactive</strong> (Leaflet) avec des marqueurs num√©rot√©s.</p>
          <p>Un <strong>score de sortie v√©lo</strong> (0-100) est calcul√© en fonction de la temp√©rature, du vent, des pr√©cipitations, de l'humidit√© et des conditions sp√©ciales (orage, brouillard). Des recommandations de tenue cycliste, des alertes et des conseils sont g√©n√©r√©s.</p>
          <p>Les r√©sultats peuvent √™tre <strong>export√©s en image PNG</strong> avec un rendu soign√© (bandeau couleur, colonnes bien espac√©es, indicateur jour/nuit, footer) ou <strong>partag√©s</strong> via l'API Web Share.</p>
        </div>
      </div>

      <!-- ===== APIs ===== -->
      <div *ngIf="sec.id === 'apis'" class="border border-slate-200 rounded-lg overflow-hidden">
        <button (click)="toggle(sec)" class="w-full flex items-center gap-2 px-4 py-3 bg-slate-50 hover:bg-slate-100 transition-colors text-left">
          <span class="text-lg">{{ sec.icon }}</span>
          <span class="font-semibold text-slate-800 flex-1">{{ sec.title }}</span>
          <svg [class.rotate-180]="sec.open" class="w-4 h-4 text-slate-400 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
        </button>
        <div *ngIf="sec.open" class="px-4 py-3 text-sm text-slate-700 border-t border-slate-100">
          <ul class="list-disc pl-5 space-y-1">
            <li><strong>G√©ocodage :</strong> <a href="https://nominatim.org/" class="text-primary hover:underline" target="_blank"> Nominatim</a> (OpenStreetMap) ‚Äî recherche d'emplacements et reverse-g√©ocodage (lat/lon ‚Üí ville)</li>
            <li><strong>M√©t√©o :</strong> <a href="https://open-meteo.com/" class="text-primary hover:underline" target="_blank"> Open-Meteo</a> ‚Äî donn√©es horaires (temp√©rature, ressenti, vent, direction, pr√©cipitations, probabilit√© de pluie, humidit√©, weathercode, jour/nuit)</li>
          </ul>
          <p class="mt-2 text-xs text-slate-500">Aucune cl√© API n'est requise. Les deux services sont gratuits et open-source.</p>
        </div>
      </div>

      <!-- ===== Architecture ===== -->
      <div *ngIf="sec.id === 'architecture'" class="border border-slate-200 rounded-lg overflow-hidden">
        <button (click)="toggle(sec)" class="w-full flex items-center gap-2 px-4 py-3 bg-slate-50 hover:bg-slate-100 transition-colors text-left">
          <span class="text-lg">{{ sec.icon }}</span>
          <span class="font-semibold text-slate-800 flex-1">{{ sec.title }}</span>
          <svg [class.rotate-180]="sec.open" class="w-4 h-4 text-slate-400 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
        </button>
        <div *ngIf="sec.open" class="px-4 py-3 text-sm text-slate-700 border-t border-slate-100">
          <ul class="list-disc pl-5 space-y-1">
            <li><strong>GpxUploaderComponent :</strong> orchestrateur principal (upload, parsing GPX, calcul d'itin√©raire, r√©cup√©ration m√©t√©o)</li>
            <li><strong>GpxMapComponent :</strong> carte Leaflet avec trac√© polyline et marqueurs num√©rot√©s</li>
            <li><strong>RideScoreComponent :</strong> calcul et affichage du score de sortie v√©lo, tenue recommand√©e, alertes</li>
            <li><strong>GpxSummaryBarComponent :</strong> barre de statistiques r√©sum√©es (distance, dur√©e, d√©part, arriv√©e)</li>
            <li><strong>GpxResultsTableComponent :</strong> tableau desktop et cartes mobile des passages m√©t√©o</li>
            <li><strong>GpxExportService :</strong> export Canvas ‚Üí PNG (avec score v√©lo) et partage Web Share</li>
            <li><strong>HistoryService :</strong> sauvegarde/chargement des trajets en localStorage, gestion quota</li>
            <li><strong>FeatureFlagService :</strong> feature flags persist√©es en localStorage (options dev cach√©es)</li>
            <li><strong>HistoryPanelComponent :</strong> panneau historique avec barre de stockage, suppression, chargement</li>
            <li><strong>WeatherSheetComponent :</strong> grille m√©t√©o horaire par ville (desktop table + mobile cards)</li>
            <li><strong>SearchTabComponent :</strong> formulaire de recherche et filtres</li>
            <li><strong>WeatherUtils :</strong> weathercode ‚Üí emoji, degr√©s ‚Üí direction cardinale</li>
          </ul>
        </div>
      </div>

      <!-- ===== L√©gende emoji ===== -->
      <div *ngIf="sec.id === 'legend'" class="border border-slate-200 rounded-lg overflow-hidden">
        <button (click)="toggle(sec)" class="w-full flex items-center gap-2 px-4 py-3 bg-slate-50 hover:bg-slate-100 transition-colors text-left">
          <span class="text-lg">{{ sec.icon }}</span>
          <span class="font-semibold text-slate-800 flex-1">{{ sec.title }}</span>
          <svg [class.rotate-180]="sec.open" class="w-4 h-4 text-slate-400 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
        </button>
        <div *ngIf="sec.open" class="px-4 py-3 text-sm text-slate-700 border-t border-slate-100">
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-1">
            <div>‚òÄÔ∏è <strong>Ciel clair</strong> <span class="text-slate-400 text-xs"> (0)</span></div>
            <div>üå§Ô∏è <strong>Partiellement nuageux</strong> <span class="text-slate-400 text-xs"> (1, 2)</span></div>
            <div>‚òÅÔ∏è <strong>Couvert</strong> <span class="text-slate-400 text-xs"> (3)</span></div>
            <div>üå´Ô∏è <strong>Brouillard</strong> <span class="text-slate-400 text-xs"> (45, 48)</span></div>
            <div>üå¶Ô∏è <strong>Bruine / Averses</strong> <span class="text-slate-400 text-xs"> (51, 53, 55, 80‚Äì82)</span></div>
            <div>üåßÔ∏è <strong>Pluie / Vergla√ßante</strong> <span class="text-slate-400 text-xs"> (56, 57, 61‚Äì67)</span></div>
            <div>‚ùÑÔ∏è <strong>Neige</strong> <span class="text-slate-400 text-xs"> (71, 73, 75, 77)</span></div>
            <div>üå®Ô∏è <strong>Averses de neige</strong> <span class="text-slate-400 text-xs"> (85, 86)</span></div>
            <div>‚õàÔ∏è <strong>Orage</strong> <span class="text-slate-400 text-xs"> (95, 96, 99)</span></div>
            <div>‚ùì <strong>Inconnu</strong> <span class="text-slate-400 text-xs"> (autres)</span></div>
          </div>
        </div>
      </div>

      <!-- ===== Remarques ===== -->
      <div *ngIf="sec.id === 'notes'" class="border border-slate-200 rounded-lg overflow-hidden">
        <button (click)="toggle(sec)" class="w-full flex items-center gap-2 px-4 py-3 bg-slate-50 hover:bg-slate-100 transition-colors text-left">
          <span class="text-lg">{{ sec.icon }}</span>
          <span class="font-semibold text-slate-800 flex-1">{{ sec.title }}</span>
          <svg [class.rotate-180]="sec.open" class="w-4 h-4 text-slate-400 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
        </button>
        <div *ngIf="sec.open" class="px-4 py-3 text-sm text-slate-700 space-y-1.5 border-t border-slate-100">
          <p>Les donn√©es sont obtenues en temps r√©el depuis les APIs publiques list√©es ci-dessus.</p>
          <p>Aucune donn√©e utilisateur n'est envoy√©e √† des services autres que ceux mentionn√©s (Open-Meteo et Nominatim).</p>
          <p>Nominatim applique des limites d'usage (1 requ√™te/seconde). L'application utilise un throttle et un √©chantillonnage par distance (~2 km) pour respecter ces contraintes.</p>
          <p>Aucun compte utilisateur, aucun cookie de tracking, aucune donn√©e personnelle stock√©e.</p>
        </div>
      </div>

      <!-- ===== Contact ===== -->
      <div *ngIf="sec.id === 'contact'" class="border border-slate-200 rounded-lg overflow-hidden">
        <button (click)="toggle(sec)" class="w-full flex items-center gap-2 px-4 py-3 bg-slate-50 hover:bg-slate-100 transition-colors text-left">
          <span class="text-lg">{{ sec.icon }}</span>
          <span class="font-semibold text-slate-800 flex-1">{{ sec.title }}</span>
          <svg [class.rotate-180]="sec.open" class="w-4 h-4 text-slate-400 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
        </button>
        <div *ngIf="sec.open" class="px-4 py-3 text-sm text-slate-700 space-y-2 border-t border-slate-100">
          <p>Une id√©e d'am√©lioration, un bug √† signaler ou simplement envie d'√©changer ?</p>
          <div class="flex flex-col sm:flex-row gap-3">
            <a href="https://github.com/aZor9/TourMeteo/issues" target="_blank"
               class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-slate-800 text-white text-sm hover:bg-slate-700 transition-colors">
              üêõ Ouvrir une issue GitHub
            </a>
             <a href="https://forms.gle/tP4UxuvYDDPnj3298" target="_blank"
               class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-indigo-600 text-white text-sm hover:bg-indigo-500 transition-colors">
              üìù Laisser un feedback
            </a>
          </div>
          <p class="text-xs text-slate-400 mt-1">Cr√©√© par Hugo Lembrez</p>
        </div>
      </div>

      <!-- ===== Options d√©veloppeur (hidden until 5 taps on version) ===== -->
      <div *ngIf="sec.id === 'devtools' && showDevOptions" class="border border-amber-300 rounded-lg overflow-hidden bg-amber-50/30">
        <button (click)="toggle(sec)" class="w-full flex items-center gap-2 px-4 py-3 bg-amber-50 hover:bg-amber-100/80 transition-colors text-left">
          <span class="text-lg">{{ sec.icon }}</span>
          <span class="font-semibold text-amber-800 flex-1">{{ sec.title }}</span>
          <span class="text-[10px] tracking-wide uppercase bg-amber-200 text-amber-700 px-1.5 py-0.5 rounded-full font-semibold">cach√©</span>
          <svg [class.rotate-180]="sec.open" class="w-4 h-4 text-amber-400 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
        </button>
        <div *ngIf="sec.open" class="px-4 py-4 text-sm text-slate-700 border-t border-amber-200 space-y-4">
          <p class="text-xs text-amber-600">Ces options activent des fonctionnalit√©s exp√©rimentales. Les pr√©f√©rences sont enregistr√©es en localStorage.</p>

          <!-- Toggle: Historique -->
          <div class="flex items-center justify-between bg-white rounded-lg px-4 py-3 border border-slate-200 shadow-sm">
            <div class="flex flex-col">
              <span class="font-medium text-slate-800">üìÇ Historique des trajets</span>
              <span class="text-xs text-slate-500">Sauvegarder les trajets et les recharger depuis l'√©cran d'upload</span>
            </div>
            <label class="relative inline-flex items-center cursor-pointer">
              <input type="checkbox" [checked]="flags.history" (change)="toggleFlag('history')" class="sr-only peer">
              <div class="w-11 h-6 bg-slate-200 rounded-full peer peer-checked:bg-emerald-500 peer-focus:ring-2 peer-focus:ring-emerald-300 transition-colors after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:after:translate-x-full shadow-inner"></div>
            </label>
          </div>

          <!-- Toggle: Experimental -->
          <div class="flex items-center justify-between bg-white rounded-lg px-4 py-3 border border-slate-200 shadow-sm">
            <div class="flex flex-col">
              <span class="font-medium text-slate-800">‚ú® Fonctionnalit√©s sp√©ciales</span>
              <span class="text-xs text-slate-500">Active la carte interactive, le rafra√Æchissement m√©t√©o et d'autres fonctionnalit√©s √† venir</span>
            </div>
            <label class="relative inline-flex items-center cursor-pointer">
              <input type="checkbox" [checked]="flags.experimental" (change)="toggleFlag('experimental')" class="sr-only peer">
              <div class="w-11 h-6 bg-slate-200 rounded-full peer peer-checked:bg-emerald-500 peer-focus:ring-2 peer-focus:ring-emerald-300 transition-colors after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:after:translate-x-full shadow-inner"></div>
            </label>
          </div>

          <p class="text-[11px] text-slate-400">üí° Astuce : tape 5√ó sur le badge de version pour afficher ce panneau.</p>
        </div>
      </div>

    </ng-container>
  </div>

</section>
</div>
