<div class="px-3 sm:px-0 max-w-3xl mx-auto py-4">
<section class="bg-white rounded-xl border border-slate-200 p-4 sm:p-6 shadow-sm">

  <!-- Header -->
  <header class="mb-6">
    <h1 class="text-2xl font-bold text-slate-900">{{ title }}</h1>
    <p class="text-slate-500 mt-1">Meteo Ride â€” application de comparaison mÃ©tÃ©o entre plusieurs villes, heure par heure, pensÃ©e pour les cyclistes et randonneurs.</p>
    <div class="flex items-center gap-3 mt-3 text-sm">
      <span (click)="onVersionTap()" class="inline-flex items-center gap-1 bg-indigo-50 text-indigo-700 px-2.5 py-0.5 rounded-full font-medium cursor-default select-none" title="Version">v2.2.0</span>
      <span class="text-slate-400">Angular 21 Â· Tailwind CSS Â· Leaflet</span>
      <span *ngIf="devTapCount >= 3 && devTapCount < 5" class="text-xs text-slate-300 animate-pulse">{{ 5 - devTapCount }} tap(s)...</span>
      <span *ngIf="showDevOptions" class="text-xs text-emerald-500 font-medium">ğŸ”“ Mode dev activÃ©</span>
    </div>
    <p class="text-slate-500 mt-2 text-sm">
      GitHub : <a href="https://github.com/aZor9/TourMeteo" class="text-primary hover:underline" target="_blank">DÃ©pÃ´t GitHub</a>
      Â· DÃ©mo : <a href="https://meteo-ride.vercel.app/" class="text-primary hover:underline" target="_blank">Voir la dÃ©mo</a>
    </p>
  </header>

  <!-- Expand / Collapse all -->
  <div class="flex gap-2 mb-4 text-xs">
    <button (click)="expandAll()" class="px-2.5 py-1 rounded bg-slate-100 hover:bg-slate-200 text-slate-600 transition-colors">Tout ouvrir</button>
    <button (click)="collapseAll()" class="px-2.5 py-1 rounded bg-slate-100 hover:bg-slate-200 text-slate-600 transition-colors">Tout fermer</button>
  </div>

  <!-- â”€â”€â”€ Accordion sections â”€â”€â”€ -->
  <div class="space-y-2">

    <!-- 0 â€” FonctionnalitÃ©s -->
    <ng-container *ngFor="let sec of sections; let idx = index">

      <!-- Group header (User / Dev) -->
      <div *ngIf="idx === 0 || sections[idx - 1].group !== sec.group" class="pt-3">
        <div class="flex items-center gap-2">
          <div class="h-px bg-slate-200 flex-1"></div>
          <h2 class="text-[11px] font-semibold text-slate-400 uppercase tracking-wider">
            {{ sec.group === 'user' ? 'Utilisateurs' : 'DÃ©veloppeurs' }}
          </h2>
          <div class="h-px bg-slate-200 flex-1"></div>
        </div>
        <p *ngIf="sec.group === 'user'" class="text-xs text-slate-500 mt-1">
          Infos principales et guide d'utilisation.
        </p>
        <p *ngIf="sec.group === 'dev'" class="text-xs text-slate-500 mt-1">
          DÃ©tails techniques (stack, APIs, architecture).
        </p>
      </div>

      <!-- ===== FEATURES ===== -->
      <div *ngIf="sec.id === 'features'" class="border border-slate-200 rounded-lg overflow-hidden">
        <button (click)="toggle(sec)" class="w-full flex items-center gap-2 px-4 py-3 bg-slate-50 hover:bg-slate-100 transition-colors text-left">
          <span class="text-lg">{{ sec.icon }}</span>
          <span class="font-semibold text-slate-800 flex-1">{{ sec.title }}</span>
          <svg [class.rotate-180]="sec.open" class="w-4 h-4 text-slate-400 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
        </button>
        <div *ngIf="sec.open" class="px-4 py-3 text-sm text-slate-700 space-y-1.5 border-t border-slate-100">
          <ul class="list-disc pl-5 space-y-1">
            <li><strong>Recherche multi-villes :</strong> comparer la mÃ©tÃ©o horaire de plusieurs villes sur une mÃªme date</li>
            <li><strong>Filtres d'affichage :</strong> tempÃ©rature, vent, rÃ©sumÃ© mÃ©tÃ©o (activables/dÃ©sactivables)</li>
            <li><strong>Vue mobile optimisÃ©e :</strong> cartes avec emoji mÃ©tÃ©o en fond, indicateur jour/nuit sous l'heure, affichage des prÃ©cipitations</li>
            <li><strong>Import GPX :</strong> charger un fichier <code>.gpx</code> pour calculer la distance totale et prÃ©voir la mÃ©tÃ©o du parcours</li>
            <li><strong>Carte interactive :</strong> tracÃ© du parcours GPX avec marqueurs numÃ©rotÃ©s (Leaflet + OpenStreetMap)</li>
            <li><strong>MÃ©tÃ©o par passage :</strong> tempÃ©rature, ressenti, vent, humiditÃ©, probabilitÃ© de pluie, prÃ©cipitations et emoji weathercode</li>
            <li><strong>Score de sortie vÃ©lo :</strong> score /100, recommandation de tenue cycliste, alertes et conseils personnalisÃ©s</li>
            <li><strong>Export PNG :</strong> image du tableau des passages avec score vÃ©lo et tenue recommandÃ©e (rendu Canvas natif)</li>
            <li><strong>Partage :</strong> via l'API Web Share ou tÃ©lÃ©chargement automatique</li>
            <li><strong>Filtres rÃ©sultats :</strong> basculer entre vue rÃ©sumÃ© et dÃ©tail complet, masquer/afficher carte, score ou tableau individuellement</li>
            <li><strong>RafraÃ®chir mÃ©tÃ©o :</strong> changer la date/heure sans re-gÃ©ocoder les villes (garde les noms de villes en cache)</li>
            <li><strong>Historique <span class="text-xs text-amber-500">(ğŸ”§ dev)</span> :</strong> sauvegarde locale des trajets, rechargement rapide, gestion du stockage</li>
          </ul>
        </div>
      </div>

      <!-- ===== GPX & EXPORT ===== -->
      <div *ngIf="sec.id === 'gpx'" class="border border-slate-200 rounded-lg overflow-hidden">
        <button (click)="toggle(sec)" class="w-full flex items-center gap-2 px-4 py-3 bg-slate-50 hover:bg-slate-100 transition-colors text-left">
          <span class="text-lg">{{ sec.icon }}</span>
          <span class="font-semibold text-slate-800 flex-1">{{ sec.title }}</span>
          <svg [class.rotate-180]="sec.open" class="w-4 h-4 text-slate-400 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
        </button>
        <div *ngIf="sec.open" class="px-4 py-3 text-sm text-slate-700 space-y-2 border-t border-slate-100">
          <p>Importez un fichier <strong>.gpx</strong> via la page <em>GPX</em>. L'application parse les points <code>trkpt</code>, calcule la distance totale (formule de Haversine), puis estime l'heure de passage et la distance cumulative Ã  chaque point selon la vitesse moyenne renseignÃ©e.</p>
          <p>Pour chaque point, un reverse-gÃ©ocodage Nominatim identifie la ville, puis la mÃ©tÃ©o horaire est rÃ©cupÃ©rÃ©e via Open-Meteo. Les doublons consÃ©cutifs sont filtrÃ©s automatiquement.</p>
          <p>Le tracÃ© complet est affichÃ© sur une <strong>carte interactive</strong> (Leaflet) avec des marqueurs numÃ©rotÃ©s.</p>
          <p>Un <strong>score de sortie vÃ©lo</strong> (0-100) est calculÃ© en fonction de la tempÃ©rature, du vent, des prÃ©cipitations, de l'humiditÃ© et des conditions spÃ©ciales (orage, brouillard). Des recommandations de tenue cycliste, des alertes et des conseils sont gÃ©nÃ©rÃ©s.</p>
          <p>Les rÃ©sultats peuvent Ãªtre <strong>exportÃ©s en image PNG</strong> avec un rendu soignÃ© (bandeau couleur, colonnes bien espacÃ©es, indicateur jour/nuit, footer) ou <strong>partagÃ©s</strong> via l'API Web Share.</p>
        </div>
      </div>

      <!-- ===== APIs ===== -->
      <div *ngIf="sec.id === 'apis'" class="border border-slate-200 rounded-lg overflow-hidden">
        <button (click)="toggle(sec)" class="w-full flex items-center gap-2 px-4 py-3 bg-slate-50 hover:bg-slate-100 transition-colors text-left">
          <span class="text-lg">{{ sec.icon }}</span>
          <span class="font-semibold text-slate-800 flex-1">{{ sec.title }}</span>
          <svg [class.rotate-180]="sec.open" class="w-4 h-4 text-slate-400 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
        </button>
        <div *ngIf="sec.open" class="px-4 py-3 text-sm text-slate-700 border-t border-slate-100">
          <ul class="list-disc pl-5 space-y-1">
            <li><strong>GÃ©ocodage :</strong> <a href="https://nominatim.org/" class="text-primary hover:underline" target="_blank"> Nominatim</a> (OpenStreetMap) â€” recherche d'emplacements et reverse-gÃ©ocodage (lat/lon â†’ ville)</li>
            <li><strong>MÃ©tÃ©o :</strong> <a href="https://open-meteo.com/" class="text-primary hover:underline" target="_blank"> Open-Meteo</a> â€” donnÃ©es horaires (tempÃ©rature, ressenti, vent, direction, prÃ©cipitations, probabilitÃ© de pluie, humiditÃ©, weathercode, jour/nuit)</li>
          </ul>
          <p class="mt-2 text-xs text-slate-500">Aucune clÃ© API n'est requise. Les deux services sont gratuits et open-source.</p>
        </div>
      </div>

      <!-- ===== Architecture ===== -->
      <div *ngIf="sec.id === 'architecture'" class="border border-slate-200 rounded-lg overflow-hidden">
        <button (click)="toggle(sec)" class="w-full flex items-center gap-2 px-4 py-3 bg-slate-50 hover:bg-slate-100 transition-colors text-left">
          <span class="text-lg">{{ sec.icon }}</span>
          <span class="font-semibold text-slate-800 flex-1">{{ sec.title }}</span>
          <svg [class.rotate-180]="sec.open" class="w-4 h-4 text-slate-400 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
        </button>
        <div *ngIf="sec.open" class="px-4 py-3 text-sm text-slate-700 border-t border-slate-100">
          <ul class="list-disc pl-5 space-y-1">
            <li><strong>GpxUploaderComponent :</strong> orchestrateur principal (upload, parsing GPX, calcul d'itinÃ©raire, rÃ©cupÃ©ration mÃ©tÃ©o)</li>
            <li><strong>GpxMapComponent :</strong> carte Leaflet avec tracÃ© polyline et marqueurs numÃ©rotÃ©s</li>
            <li><strong>RideScoreComponent :</strong> calcul et affichage du score de sortie vÃ©lo, tenue recommandÃ©e, alertes</li>
            <li><strong>GpxSummaryBarComponent :</strong> barre de statistiques rÃ©sumÃ©es (distance, durÃ©e, dÃ©part, arrivÃ©e)</li>
            <li><strong>GpxResultsTableComponent :</strong> tableau desktop et cartes mobile des passages mÃ©tÃ©o</li>
            <li><strong>GpxExportService :</strong> export Canvas â†’ PNG (avec score vÃ©lo) et partage Web Share</li>
            <li><strong>HistoryService :</strong> sauvegarde/chargement des trajets en localStorage, gestion quota</li>
            <li><strong>FeatureFlagService :</strong> feature flags persistÃ©es en localStorage (options dev cachÃ©es)</li>
            <li><strong>HistoryPanelComponent :</strong> panneau historique avec barre de stockage, suppression, chargement</li>
            <li><strong>WeatherSheetComponent :</strong> grille mÃ©tÃ©o horaire par ville (desktop table + mobile cards)</li>
            <li><strong>SearchTabComponent :</strong> formulaire de recherche et filtres</li>
            <li><strong>WeatherUtils :</strong> weathercode â†’ emoji, degrÃ©s â†’ direction cardinale</li>
          </ul>
        </div>
      </div>

      <!-- ===== LÃ©gende emoji ===== -->
      <div *ngIf="sec.id === 'legend'" class="border border-slate-200 rounded-lg overflow-hidden">
        <button (click)="toggle(sec)" class="w-full flex items-center gap-2 px-4 py-3 bg-slate-50 hover:bg-slate-100 transition-colors text-left">
          <span class="text-lg">{{ sec.icon }}</span>
          <span class="font-semibold text-slate-800 flex-1">{{ sec.title }}</span>
          <svg [class.rotate-180]="sec.open" class="w-4 h-4 text-slate-400 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
        </button>
        <div *ngIf="sec.open" class="px-4 py-3 text-sm text-slate-700 border-t border-slate-100">
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-1">
            <div>â˜€ï¸ <strong>Ciel clair</strong> <span class="text-slate-400 text-xs"> (0)</span></div>
            <div>ğŸŒ¤ï¸ <strong>Partiellement nuageux</strong> <span class="text-slate-400 text-xs"> (1, 2)</span></div>
            <div>â˜ï¸ <strong>Couvert</strong> <span class="text-slate-400 text-xs"> (3)</span></div>
            <div>ğŸŒ«ï¸ <strong>Brouillard</strong> <span class="text-slate-400 text-xs"> (45, 48)</span></div>
            <div>ğŸŒ¦ï¸ <strong>Bruine / Averses</strong> <span class="text-slate-400 text-xs"> (51, 53, 55, 80â€“82)</span></div>
            <div>ğŸŒ§ï¸ <strong>Pluie / VerglaÃ§ante</strong> <span class="text-slate-400 text-xs"> (56, 57, 61â€“67)</span></div>
            <div>â„ï¸ <strong>Neige</strong> <span class="text-slate-400 text-xs"> (71, 73, 75, 77)</span></div>
            <div>ğŸŒ¨ï¸ <strong>Averses de neige</strong> <span class="text-slate-400 text-xs"> (85, 86)</span></div>
            <div>â›ˆï¸ <strong>Orage</strong> <span class="text-slate-400 text-xs"> (95, 96, 99)</span></div>
            <div>â“ <strong>Inconnu</strong> <span class="text-slate-400 text-xs"> (autres)</span></div>
          </div>
        </div>
      </div>

      <!-- ===== Remarques ===== -->
      <div *ngIf="sec.id === 'notes'" class="border border-slate-200 rounded-lg overflow-hidden">
        <button (click)="toggle(sec)" class="w-full flex items-center gap-2 px-4 py-3 bg-slate-50 hover:bg-slate-100 transition-colors text-left">
          <span class="text-lg">{{ sec.icon }}</span>
          <span class="font-semibold text-slate-800 flex-1">{{ sec.title }}</span>
          <svg [class.rotate-180]="sec.open" class="w-4 h-4 text-slate-400 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
        </button>
        <div *ngIf="sec.open" class="px-4 py-3 text-sm text-slate-700 space-y-1.5 border-t border-slate-100">
          <p>Les donnÃ©es sont obtenues en temps rÃ©el depuis les APIs publiques listÃ©es ci-dessus.</p>
          <p>Aucune donnÃ©e utilisateur n'est envoyÃ©e Ã  des services autres que ceux mentionnÃ©s (Open-Meteo et Nominatim).</p>
          <p>Nominatim applique des limites d'usage (1 requÃªte/seconde). L'application utilise un throttle et un Ã©chantillonnage par distance (~2 km) pour respecter ces contraintes.</p>
          <p>Aucun compte utilisateur, aucun cookie de tracking, aucune donnÃ©e personnelle stockÃ©e.</p>
        </div>
      </div>

      <!-- ===== Contact ===== -->
      <div *ngIf="sec.id === 'contact'" class="border border-slate-200 rounded-lg overflow-hidden">
        <button (click)="toggle(sec)" class="w-full flex items-center gap-2 px-4 py-3 bg-slate-50 hover:bg-slate-100 transition-colors text-left">
          <span class="text-lg">{{ sec.icon }}</span>
          <span class="font-semibold text-slate-800 flex-1">{{ sec.title }}</span>
          <svg [class.rotate-180]="sec.open" class="w-4 h-4 text-slate-400 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
        </button>
        <div *ngIf="sec.open" class="px-4 py-3 text-sm text-slate-700 space-y-2 border-t border-slate-100">
          <p>Une idÃ©e d'amÃ©lioration, un bug Ã  signaler ou simplement envie d'Ã©changer ?</p>
          <div class="flex flex-col sm:flex-row gap-3">
            <a href="https://github.com/aZor9/TourMeteo/issues" target="_blank"
               class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-slate-800 text-white text-sm hover:bg-slate-700 transition-colors">
              ğŸ› Ouvrir une issue GitHub
            </a>
             <a href="https://forms.gle/tP4UxuvYDDPnj3298" target="_blank"
               class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-indigo-600 text-white text-sm hover:bg-indigo-500 transition-colors">
              ğŸ“ Laisser un feedback
            </a>
          </div>
          <p class="text-xs text-slate-400 mt-1">CrÃ©Ã© par Hugo Lembrez</p>
        </div>
      </div>

      <!-- ===== Options dÃ©veloppeur (hidden until 5 taps on version) ===== -->
      <div *ngIf="sec.id === 'devtools' && showDevOptions" class="border border-amber-300 rounded-lg overflow-hidden bg-amber-50/30">
        <button (click)="toggle(sec)" class="w-full flex items-center gap-2 px-4 py-3 bg-amber-50 hover:bg-amber-100/80 transition-colors text-left">
          <span class="text-lg">{{ sec.icon }}</span>
          <span class="font-semibold text-amber-800 flex-1">{{ sec.title }}</span>
          <span class="text-[10px] tracking-wide uppercase bg-amber-200 text-amber-700 px-1.5 py-0.5 rounded-full font-semibold">cachÃ©</span>
          <svg [class.rotate-180]="sec.open" class="w-4 h-4 text-amber-400 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
        </button>
        <div *ngIf="sec.open" class="px-4 py-4 text-sm text-slate-700 border-t border-amber-200 space-y-4">
          <p class="text-xs text-amber-600">Ces options activent des fonctionnalitÃ©s expÃ©rimentales. Les prÃ©fÃ©rences sont enregistrÃ©es en localStorage.</p>

          <!-- Toggle: Historique -->
          <div class="flex items-center justify-between bg-white rounded-lg px-4 py-3 border border-slate-200 shadow-sm">
            <div class="flex flex-col">
              <span class="font-medium text-slate-800">ğŸ“‚ Historique des trajets</span>
              <span class="text-xs text-slate-500">Sauvegarder les trajets et les recharger depuis l'Ã©cran d'upload</span>
            </div>
            <label class="relative inline-flex items-center cursor-pointer">
              <input type="checkbox" [checked]="flags.history" (change)="toggleFlag('history')" class="sr-only peer">
              <div class="w-11 h-6 bg-slate-200 rounded-full peer peer-checked:bg-emerald-500 peer-focus:ring-2 peer-focus:ring-emerald-300 transition-colors after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:after:translate-x-full shadow-inner"></div>
            </label>
          </div>

          <!-- Toggle: Experimental -->
          <!-- <div class="flex items-center justify-between bg-white rounded-lg px-4 py-3 border border-slate-200 shadow-sm">
            <div class="flex flex-col">
              <span class="font-medium text-slate-800">ğŸ§ª FonctionnalitÃ©s expÃ©rimentales</span>
              <span class="text-xs text-slate-500">Active de futures fonctionnalitÃ©s en cours de dÃ©veloppement</span>
            </div>
            <label class="relative inline-flex items-center cursor-pointer">
              <input type="checkbox" [checked]="flags.experimental" (change)="toggleFlag('experimental')" class="sr-only peer">
              <div class="w-11 h-6 bg-slate-200 rounded-full peer peer-checked:bg-emerald-500 peer-focus:ring-2 peer-focus:ring-emerald-300 transition-colors after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:after:translate-x-full shadow-inner"></div>
            </label>
          </div> -->

          <p class="text-[11px] text-slate-400">ğŸ’¡ Astuce : tape 5Ã— sur le badge de version pour afficher ce panneau.</p>
        </div>
      </div>

    </ng-container>
  </div>

</section>
</div>
